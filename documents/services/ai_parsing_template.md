# Шаблон для парсингу документів через AI

## === ІНСТРУКЦІЇ ДЛЯ ПАРСИНГУ ===

**Завдання:** Розпізнай документ і поверни дані суворо у форматі JSON.

**Логіка обробки:**

### VAT (ПДВ)
- Якщо ставка не вказана явно, обчисли її математично
- Якщо різниця між ціною з ПДВ та без ПДВ ≈ 20%, став `tax_percent: 20`
- Інакше `tax_percent: 0`

### Units (Одиниці виміру)
- НЕ конвертуй одиниці виміру
- Залишай як в документі: "100 шт", "пак", "м.п", "послуга" тощо

### Cleaning (Очищення)
- Видаляй спецсимволи (X/, *, #) з артикулів
- Очищай коди УКТ ЗЕД (тільки цифри)
- Видаляй зайві пробіли з назв товарів

### Розрахунки
- Якщо ціна без ПДВ не вказана, розрахуй: `price_unit = price_total / (1 + tax_percent/100)`
- Якщо сума без ПДВ не вказана, розрахуй: `price_subtotal = price_unit * quantity`
- Завжди перевіряй: `price_total = price_subtotal * (1 + tax_percent/100)`

### МФО банку
- Якщо МФО не вказано явно, витягни з символів 5-10 IBAN
- Формат IBAN: `UA` + 2 цифри (контрольні) + 6 цифр (МФО) + решта
- Якщо не можеш визначити — поверни `null`

### Терміни оплати
- Якщо вказано "5 днів з дати виписки" — розрахуй дату: `doc_date + 5 днів`
- Якщо термін не вказаний — поверни `null`

---

## === JSON SCHEMA ===

```json
{
  "header": {
    // === ЗАГАЛЬНА ІНФОРМАЦІЯ ПРО ДОКУМЕНТ ===
    "doc_type": "string | null - Тип документа: 'Видаткова накладна', 'Рахунок', 'Акт' тощо",
    "doc_number": "string | null - Номер документа (як в оригіналі)",
    "doc_date": "string | null - Дата документа у форматі YYYY-MM-DD",
    
    // === ДАНІ ПОСТАЧАЛЬНИКА ===
    "vendor_name": "string | null - Повна юридична назва постачальника",
    "vendor_edrpou": "string | null - Код ЄДРПОУ (тільки 8 або 10 цифр)",
    "vendor_ipn": "string | null - ІПН постачальника (тільки цифри)",
    "vendor_address": "string | null - Повна адреса постачальника",
    "vendor_phone": "string | null - Телефони постачальника",
    "tax_system": "string | null - Статус платника податків (напр. 'Загальна система', 'Спрощена система', 'ПДВ')",
    
    // === БАНКІВСЬКІ РЕКВІЗИТИ ПОСТАЧАЛЬНИКА ===
    "vendor_iban": "string | null - Номер рахунку у форматі UAxxxxxxxxxxxxxxxxxx (28 символів)",
    "vendor_bank": "string | null - Повна назва банку постачальника",
    "vendor_bank_city": "string | null - Місто банку постачальника",
    "vendor_mfo": "string | null - МФО банку (6 цифр). Витягни з позицій 5-10 IBAN або залиш null",
    
    // === СУМИ ДОКУМЕНТА ===
    "currency": "string - Валюта документа (за замовчуванням 'UAH')",
    "amount_untaxed": "number - Загальна сума БЕЗ ПДВ (сума всіх price_subtotal)",
    "amount_tax": "number - Сума ПДВ (різниця між amount_total та amount_untaxed)",
    "amount_total": "number - Повна сума ДО СПЛАТИ (з ПДВ)",
    "due_date": "string | null - Дата оплати у форматі YYYY-MM-DD (розрахуй, якщо вказано термін у днях)"
  },
  
  "lines": [
    {
      // === БАЗОВА ІНФОРМАЦІЯ ПРО ПОЗИЦІЮ ===
      "line_number": "integer - Порядковий номер рядка (1, 2, 3...)",
      "name": "string - Назва товару/послуги (очищена від зайвих пробілів, артикулів та штрихкодів)",
      
      // === КІЛЬКІСТЬ ТА ОДИНИЦІ ===
      "quantity": "number - Кількість (формат: 0.000)",
      "unit": "string - Оригінальна одиниця виміру з документа ('шт', '100 шт', 'грн', 'м.п', 'послуга' тощо)",
      
      // === ЦІНИ ТА СУМИ ===
      "price_unit": "number - Ціна за одиницю БЕЗ ПДВ (формат: 0.00). Якщо не дано - розрахуй",
      "tax_percent": "integer - Ставка ПДВ: 0 або 20 (визнач математично за різницею цін)",
      "price_subtotal": "number - Сума рядка БЕЗ ПДВ (формат: 0.00). Якщо не дано - розрахуй",
      "price_total": "number - Сума рядка З ПДВ (формат: 0.00). Якщо не дано - розрахуй",
      
      // === ДОДАТКОВІ ІДЕНТИФІКАТОРИ ===
      "article": "string | null - Артикул виробника (очищений від спецсимволів)",
      "ukt_zed": "string | null - Код УКТ ЗЕД (тільки цифри, без роздільників)",
      "barcodes": "array - Масив всіх штрихкодів для цієї позиції (або порожній масив [])"
    }
  ],
  
  "metadata": {
    "source": "string | null - Ім'я файлу або джерело документа",
    "origin_invoice": "string | null - Номер документа-підстави (якщо є посилання на інший документ)"
  }
}
```

---

## === ПРИКЛАД ВІДПОВІДІ ===

```json
{
  "header": {
    "doc_type": "Видаткова накладна",
    "doc_number": "ВН-2024-00123",
    "doc_date": "2024-01-15",
    "vendor_name": "ТОВ \"ПОСТАЧАЛЬНИК\"",
    "vendor_edrpou": "12345678",
    "vendor_ipn": null,
    "vendor_address": "м. Київ, вул. Хрещатик, 1",
    "vendor_phone": "+380441234567",
    "tax_system": "Загальна система",
    "vendor_iban": "UA123456789012345678901234",
    "vendor_bank": "АТ \"ПРИВАТБАНК\"",
    "vendor_bank_city": "Київ",
    "vendor_mfo": "305299",
    "currency": "UAH",
    "amount_untaxed": 10000.00,
    "amount_tax": 2000.00,
    "amount_total": 12000.00,
    "due_date": "2024-01-20"
  },
  "lines": [
    {
      "line_number": 1,
      "name": "Товар № 1",
      "quantity": 10.000,
      "unit": "шт",
      "price_unit": 1000.00,
      "tax_percent": 20,
      "price_subtotal": 10000.00,
      "price_total": 12000.00,
      "article": "ART-001",
      "ukt_zed": "12345678",
      "barcodes": ["4820012345678"]
    }
  ],
  "metadata": {
    "source": "invoice_001.pdf",
    "origin_invoice": null
  }
}
```
